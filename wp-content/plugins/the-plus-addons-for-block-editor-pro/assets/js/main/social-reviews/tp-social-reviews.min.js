!function(b){"use strict";b(".tpgb-social-reviews").each(function(){var i,l,s,g,h,e,a,o=b(this),n=o.data("id"),d=o.data("scroll-normal"),r=o.data("textlimit");if(1==d.ScrollOn&&0==d.TextLimit){let t=o.find(".showtext");t.each(function(){b(this)[0].clientHeight>=d.Height&&(b(this).addClass(d.className),b(this).css("height",d.Height))})}b(document).on("click",".tpgb-block-"+n+".tpgb-social-reviews .readbtn",function(){var e=b(this).closest(".tpgb-message"),t=e.closest(".tpgb-isotope .post-loop-inner"),a=e.closest(".tpgb-social-reviews").data("scroll-normal"),o=e.find(".showtext");if(e.hasClass("show-text"))e.removeClass("show-text show-less"),b(this).html(r.showmoretxt),e.find(".sf-dots").css("display","inline"),1==a.ScrollOn&&1==a.TextLimit&&(o.removeClass(a.className),o.removeAttr("style"));else{e.addClass("show-text show-less"),b(this).html(r.showlesstxt),e.find(".sf-dots").css("display","none");let t=b(".tpgb-social-reviews").find(o);1==a.ScrollOn&&1==a.TextLimit&&t.each(function(){b(this)[0].clientHeight>=a.Height&&(o.addClass(a.className),o.css("height",a.Height))})}t.isotope({itemSelector:".grid-item",resizable:!0,sortBy:"original-order"})}),b(".tpgb-block-"+n).on("click",".batch-btn-no",function(t){t.preventDefault(),this.closest(".tpgb-batch-recommend").style.display="none"}),0<b(".tpgb-block-"+n+".tpgb-social-reviews").find(".tpgb-review-load-more").length&&b(".tpgb-block-"+n+" .review-load-more").on("click",function(t){t.preventDefault();var n=b(this),t=n.data("loadattr"),e=n.attr("data-display"),o=n.data("loadview"),d=n.data("loadclass"),r=n.data("layout"),a=n.data("loadingtxt"),p=n.text();n.data("requestRunning")||(n.data("requestRunning",!0),b.ajax({type:"POST",data:"action=tpgb_reviews_load&view="+e+"&loadFview="+o+"&loadattr="+t,url:tpgb_load.ajaxUrl,beforeSend:function(){b(n).text(a)},success:function(t){var a=t&&t.HTMLContent?t.HTMLContent:"",i=t&&t.TotalReview?t.TotalReview:"",l=t&&t.FilterStyle?t.FilterStyle:"",s=t&&t.allposttext?t.allposttext:"";if(""==t)b(n).addClass("hide");else{let o=".tpgb-block-"+d,t=b(o+" .all .tpgb-category-count"),e=b(o+" .post-loop-inner");e.append(a);a=b(o).find(".grid-item").length;b(t).html("").append(a),"style-2"!=l&&"style-3"!=l||(l=b(o+" .tpgb-filter-list .tpgb-category-list").not(".all"),b.each(l,function(t,e){var a=b(e).find("span:nth-child(2)").data("hover"),a=b(o).find(".grid-item."+a).length;b(e).find("span:nth-child(1).tpgb-category-count").html("").append(a)})),"grid"!=r&&"masonry"!=r||b(o).hasClass("tpgb-isotope")&&b(e).isotope("layout").isotope("reloadItems"),i<=a?(b(n).addClass("hide"),b(n).parent(".tpgb-review-load-more").append('<div class="tpgb-review-loaded">'+s+"</div>")):b(n).text(p)}e=Number(e)+Number(o),n.attr("data-display",e)},complete:function(){n.data("requestRunning",!1)}}).then(function(){b(".tpgb-block-"+d).hasClass("tpgb-isotope")&&("grid"!=r&&"masonry"!=r||b(".tpgb-block-"+d+" .post-loop-inner").isotope({itemSelector:".grid-item",resizable:!0,sortBy:"original-order"}))}))}),b("body").find(".tpgb-block-"+n+" .tpgb-review-lazy-load").length&&(e=b(window),(a=function(){e.width(),i=e.height(),l=b("body").height(),g=b(".tpgb-block-"+n+".tpgb-isotope").height(),h=b(".tpgb-block-"+n+".tpgb-isotope").offset().top+50,setTimeout(function(){g=b(".tpgb-block-"+n+".tpgb-isotope").height(),h=b(".tpgb-block-"+n+".tpgb-isotope").offset().top+50},50)})(),e.resize(a),e.bind("scroll",function(t){t.preventDefault(),a(),s=e.scrollTop(),b(".tpgb-block-"+n+".tpgb-isotope").each(function(){var n,t,e,o,d,r,p,a,c;g=b(this).height(),h=b(this).offset().top+50,b(this).find(".review-lazy-load").length&&s<l&&g+h-i<s+60&&(t=(n=b(this).find(".review-lazy-load")).data("lazyattr"),e=n.data("totalreviews"),o=n.attr("data-display"),d=n.data("lazyview"),r=n.data("lazyclass"),p=n.data("lazylayout"),a=n.data("loadingtxt"),c=n.text(),n.data("requestRunning")||(n.data("requestRunning",!0),o<=e&&b.ajax({type:"POST",data:"action=tpgb_reviews_load&view="+o+"&loadFview="+d+"&loadattr="+t,url:tpgb_load.ajaxUrl,beforeSend:function(){b(n).text(a)},success:function(t){var a=t&&t.HTMLContent?t.HTMLContent:"",i=t&&t.TotalReview?t.TotalReview:"",l=t&&t.FilterStyle?t.FilterStyle:"",s=t&&t.allposttext?t.allposttext:"";if(""==t)b(n).addClass("hide");else{let o=".tpgb-block-"+r,t=b(o+" .all .tpgb-category-count"),e=b(o+" .post-loop-inner");e.append(a);a=b(o).find(".grid-item").length;b(t).html("").append(a),"style-2"!=l&&"style-3"!=l||(l=b(o+" .tpgb-filter-list .tpgb-category-list").not(".all"),b.each(l,function(t,e){var a=b(e).find("span:nth-child(2)").data("hover"),a=b(o).find(".grid-item."+a).length;b(e).find("span:nth-child(1).tpgb-category-count").html("").append(a)})),"grid"!=p&&"masonry"!=p||b(o).hasClass("tpgb-isotope")&&b(e).isotope("layout").isotope("reloadItems"),i<=a?0==n.next(".tpgb-review-loaded").length&&(b(n).addClass("hide"),b(n).parent(".tpgb-review-lazy-load").append('<div class="tpgb-review-loaded">'+s+"</div>")):b(n).text(c)}o=Number(o)+Number(d),n.attr("data-display",o)},complete:function(){n.data("requestRunning",!1)}}).then(function(){b(".tpgb-block-"+r).hasClass("tpgb-isotope")&&("grid"!=p&&"masonry"!=p||b(".tpgb-block-"+r+" .post-loop-inner").isotope({itemSelector:".grid-item",resizable:!0,sortBy:"original-order"}))})))})})),o.find(".batch-btn-no").on("click",function(t){t.preventDefault(),b(this).closest(".tpgb-batch-recommend").slideToggle()})})}(jQuery);